#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_TASKS 100
#define MAX_LEN 100

void addTask();
void viewTasks();
void deleteTask();
void saveTasks();
void loadTasks();

char tasks[MAX_TASKS][MAX_LEN];
int taskCount = 0;

int main() {
    int choice;
    loadTasks();   // Load tasks from file at start

    while (1) {
        printf("\n====== TO-DO LIST MENU ======\n");
        printf("1. Add Task\n");
        printf("2. View Tasks\n");
        printf("3. Delete Task\n");
        printf("4. Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);
        getchar(); // clear input buffer

        switch (choice) {
            case 1: addTask(); break;
            case 2: viewTasks(); break;
            case 3: deleteTask(); break;
            case 4: saveTasks(); exit(0);
            default: printf("Invalid choice! Try again.\n");
        }
    }
}

void addTask() {
    if (taskCount >= MAX_TASKS) {
        printf("Task list is full!\n");
        return;
    }

    printf("Enter new task: ");
    fgets(tasks[taskCount], MAX_LEN, stdin);
    tasks[taskCount][strcspn(tasks[taskCount], "\n")] = '\0'; // remove newline
    taskCount++;

    printf("Task added successfully!\n");
}

void viewTasks() {
    if (taskCount == 0) {
        printf("No tasks found!\n");
        return;
    }

    printf("\n------ Your Tasks ------\n");
    for (int i = 0; i < taskCount; i++) {
        printf("%d. %s\n", i + 1, tasks[i]);
    }
}

void deleteTask() {
    int num;
    viewTasks();

    if (taskCount == 0) return;

    printf("\nEnter task number to delete: ");
    scanf("%d", &num);

    if (num < 1 || num > taskCount) {
        printf("Invalid task number!\n");
        return;
    }

    for (int i = num - 1; i < taskCount - 1; i++) {
        strcpy(tasks[i], tasks[i + 1]);
    }

    taskCount--;
    printf("Task deleted successfully!\n");
}

void saveTasks() {
    FILE *fp = fopen("tasks.txt", "w");

    for (int i = 0; i < taskCount; i++) {
        fprintf(fp, "%s\n", tasks[i]);
    }

    fclose(fp);
}

void loadTasks() {
    FILE *fp = fopen("tasks.txt", "r");
    if (fp == NULL) return;

    while (fgets(tasks[taskCount], MAX_LEN, fp)) {
        tasks[taskCount][strcspn(tasks[taskCount], "\n")] = '\0';
        taskCount++;
    }

    fclose(fp);
}
